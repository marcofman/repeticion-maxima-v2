<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©todo Mil√≥n: Nivel 2</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='35' width='25' height='30' rx='5' fill='%23f59e0b'/><rect x='65' y='35' width='25' height='30' rx='5' fill='%23f59e0b'/><rect x='30' y='45' width='40' height='10' rx='5' fill='%23f59e0b'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Manrope', sans-serif; }
        h1, h2, h3, h4, .font-bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; }
        .gradient-text { background: linear-gradient(to right, #f59e0b, #ef4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .week-tab-active, .day-tab-active { background-color: #f59e0b; color: #ffffff; }
        .week-tab-inactive, .day-tab-inactive { background-color: #e5e7eb; color: #4b5563; }
        .day-checked { background-color: #f59e0b !important; color: #ffffff !important; border-color: #f59e0b !important; }
        .set-checkbox:checked + label { text-decoration: line-through; color: #9ca3af; }
        .hidden { display: none; }
        /* Estilos para el toggle Gym/Casa */
        .mode-toggle-bg { background-color: #e5e7eb; }
        .mode-toggle-btn {
            background-color: #ffffff;
            color: #f59e0b;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .mode-toggle-btn.active {
            background-color: #f59e0b;
            color: #ffffff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .mode-toggle-btn.gym.active { transform: translateX(0%); }
        .mode-toggle-btn.casa.active { transform: translateX(100%); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <h1 class="text-6xl md:text-7xl font-extrabold gradient-text">M√âTODO MIL√ìN</h1>
            <h2 class="text-xl md:text-2xl text-gray-800 font-semibold mt-2 font-bebas">POR PROF. MARCO FLORES</h2>
            <p class="text-lg text-gray-600 mt-2">Nivel 2: Hipertrofia Base</p>
        </header>
        
        <div class="text-center mb-12 space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="open-guide-btn" class="bg-gray-800 text-amber-400 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-black transition-all duration-300 transform hover:scale-105 font-bebas text-xl">
                GU√çA ESENCIAL
            </button>
            <button id="open-theory-btn" class="bg-gray-800 text-amber-400 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-black transition-all duration-300 transform hover:scale-105 font-bebas text-xl">
                LA TEOR√çA DE MIL√ìN
            </button>
        </div>

        <main>
            <section id="workout-view"> 
                <div id="level-intro-text" class="bg-amber-50 border border-amber-200 text-amber-800 p-4 rounded-lg mb-8 text-center"></div>
                
                <div id="rutinas">
                    <h2 id="workout-title" class="text-4xl text-gray-900 mb-6 text-center font-bebas"></h2>
                    
                    <div id="week-tabs" class="flex justify-center mb-2 border-b-2 border-gray-300"></div>
                    <div id="day-tabs" class="flex flex-wrap justify-center mb-6"></div>

                    <div class="flex justify-center mb-6">
                        <div class="relative w-64 p-1 rounded-lg mode-toggle-bg grid grid-cols-2 gap-1">
                            <button id="mode-btn-gym" class="mode-toggle-btn gym relative z-10 w-full py-2 px-4 rounded-md font-bebas text-lg">
                                GIMNASIO
                            </button>
                            <button id="mode-btn-casa" class="mode-toggle-btn casa relative z-10 w-full py-2 px-4 rounded-md font-bebas text-lg">
                                CASA
                            </button>
                        </div>
                    </div>

                    <div id="workouts-container" class="space-y-6"></div>
                </div>
                
                <div id="calendario" class="mt-12">
                    <h2 class="text-4xl text-gray-900 mb-6 text-center font-bebas">Calendario de Seguimiento Semanal</h2>
                    <div class="flex justify-center"></div>
                </div>
            </section>
        </main>

        <section id="coach-profile" class="bg-gray-100 p-8 rounded-2xl mt-12">
            <div class="text-center">
                <h3 class="text-3xl text-gray-900 font-bebas">Mensaje del Coach</h3>
                <p class="text-amber-600 font-semibold mt-1">Prof. Marco Flores</p>
                <p class="text-gray-700 mt-4 max-w-xl mx-auto">
                    ¬°Felicidades por llegar al Nivel 2! Ya tienes la base t√©cnica. Ahora es momento de aumentar el volumen y buscar esa fatiga muscular controlada. En esta fase, la "sensaci√≥n" del m√∫sculo trabajando es clave. No solo muevas el peso, contr√≥lalo.
                </p>
                <blockquote class="mt-6 italic text-gray-600 border-l-4 border-amber-300 pl-4 inline-block text-left">
                    ‚ÄúEl m√∫sculo no sabe cu√°nto peso hay en la barra, solo sabe cu√°nta tensi√≥n siente.‚Äù
                </blockquote>
            </div>
        </section>

        <footer class="text-center mt-12 py-6 border-t border-gray-300">
            <h3 class="text-3xl text-gray-900 font-bebas mb-4">¬øListo para el Siguiente Nivel?</h3>
            <h4 class="text-xl font-bebas text-gray-900">M√©todo Mil√≥n</h4>
            <p class="text-sm text-gray-600 mb-6">Tu Coach de Recomposici√≥n Corporal</p>
            <a href="https://wa.me/56948505747?text=Hola%20Marco%2C%20termin%C3%A9%20el%20Nivel%202%20y%20quiero%20el%20Nivel%203" target="_blank" class="bg-amber-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-amber-600 transition-all duration-300 transform hover:scale-105 font-bebas text-xl inline-flex items-center gap-2">
                <span>¬°QUIERO EL NIVEL 3!</span>
            </a>
        </footer>
    </div>

    <div id="guide-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div id="guide-modal-overlay" class="absolute inset-0 bg-black opacity-70"></div>
        <div class="bg-white rounded-2xl shadow-2xl z-10 w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
            <div class="p-6 sm:p-8">
                <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
                    <h2 id="guide-modal-title" class="text-4xl text-gray-900 font-bebas">Gu√≠a Esencial del Nivel 2</h2>
                    <button id="close-guide-btn" class="text-3xl text-gray-500 hover:text-gray-900 leading-none">&times;</button>
                </div>

                <div id="guide-main-view" class="space-y-6 text-gray-700">
                    <div>
                        <h3 class="text-2xl text-amber-600 mb-2 font-bebas">1. Acumulaci√≥n de Volumen</h3>
                        <p>En este nivel notar√°s m√°s series y ejercicios accesorios. El objetivo es estresar metab√≥licamente al m√∫sculo. Descansa lo necesario (60-90s) pero mant√©n el ritmo.</p>
                    </div>
                    <div>
                        <h3 class="text-2xl text-amber-600 mb-2 font-bebas">2. RIR 2 (Intensidad Controlada)</h3>
                        <p>Ya no dejamos 4 reps en el tanque. Ahora trabajamos dejando solo 2. Las √∫ltimas repeticiones de cada serie deben costar y sentirse lentas.</p>
                    </div>
                    <div>
                        <h3 class="text-2xl text-amber-600 mb-2 font-bebas">3. Frecuencia y Divisi√≥n</h3>
                        <p>Pasamos a una divisi√≥n m√°s espec√≠fica (Torso/Pierna o similar) para darle m√°s foco a cada grupo muscular por sesi√≥n.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="theory-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div id="theory-modal-overlay" class="absolute inset-0 bg-black opacity-70"></div>
        <div class="bg-white rounded-2xl shadow-2xl z-10 w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
            <div class="p-6 sm:p-8">
                <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6"><h2 class="text-4xl text-gray-900 font-bebas">Hipertrofia: La Ciencia</h2><button id="close-theory-btn" class="text-3xl text-gray-500 hover:text-gray-900 leading-none">&times;</button></div>
                <div class="space-y-4 text-gray-700">
                    <p>Para que el m√∫sculo crezca (Hipertrofia), necesitamos 3 factores:</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li><strong>Tensi√≥n Mec√°nica:</strong> Cargar peso y sentir la resistencia. (Lo hicimos en Nivel 1).</li>
                        <li><strong>Estr√©s Metab√≥lico:</strong> Esa sensaci√≥n de "quemaz√≥n" y bombeo. (Foco del Nivel 2).</li>
                        <li><strong>Da√±o Muscular:</strong> Micro-roturas que se reparan m√°s fuertes. (Consecuencia del entrenamiento).</li>
                    </ul>
                    <p class="font-bold text-amber-800 mt-4">En este nivel buscaremos equilibrar la Tensi√≥n con el Estr√©s Metab√≥lico para maximizar el crecimiento.</p>
                </div>
            </div>
        </div>
    </div>

<script>
    // ==========================================
    // DATOS DEL PROGRAMA NIVEL 2
    // ==========================================
    const programData = {
        nivel: 2,
        titulo: 'Nivel 2: Hipertrofia Base',
        intro: "¬°Bienvenido al Nivel 2! Dejamos atr√°s la adaptaci√≥n. Ahora entramos en la fase de Acumulaci√≥n. Aumentaremos el volumen de trabajo y la complejidad de los ejercicios. Prep√°rate para sentir m√°s congesti√≥n y fatiga muscular controlada.",
        semanas: {
            1: {
                focus: "Semana 1: Introducci√≥n al Volumen",
                dias: ['D√≠a 1: Pierna (Cu√°driceps)', 'D√≠a 2: Torso (Empuje+Tracci√≥n)', 'D√≠a 3: Descanso', 'D√≠a 4: Pierna (Cadena Posterior)', 'D√≠a 5: Torso (Hipertrofia)'],
                workouts: {
                    // D√çA 1: PIERNA ENFOQUE CU√ÅDRICEPS
                    0: {
                        gym: {
                            exercises: [
                                { name: 'Sentadilla Trasera (Barra)', sets: 4, reps: '8-10', rest: '120s', rir: '2', tip: 'Barra sobre trapecios. Rompe la paralela. Controla la bajada.' },
                                { name: 'Prensa 45¬∫', sets: 3, reps: '12-15', rest: '90s', rir: '2', tip: 'Pies ancho de hombros. No bloquees rodillas al extender.' },
                                { name: 'Zancadas Est√°ticas (Mancuernas)', sets: 3, reps: '10/pierna', rest: '75s', rir: '2', tip: 'Torso vertical para enfocar en cu√°driceps.' },
                                { name: 'Extensiones de Cu√°driceps', sets: 3, reps: '15-20', rest: '60s', rir: '1-2', tip: 'Aguanta 1 segundo arriba en cada repetici√≥n.' },
                                { name: 'Plancha Abdominal', sets: 3, reps: '45s', rest: '60s', rir: '-', tip: 'Contrae gl√∫teos y abdomen fuerte.' }
                            ]
                        },
                        casa: {
                            exercises: [
                                { name: 'Sentadilla Goblet (Mochila pesada)', sets: 4, reps: '12-15', rest: '90s', rir: '1-2', tip: 'Talones elevados con un libro para m√°s √©nfasis en quads.' },
                                { name: 'Sentadilla B√∫lgara', sets: 3, reps: '10-12 c/u', rest: '90s', rir: '2', tip: 'Torso vertical. Rodilla trasera cerca del suelo.' },
                                { name: 'Zancadas Caminando', sets: 3, reps: '20 pasos', rest: '60s', rir: '2', tip: 'Pasos cortos para enfatizar cu√°driceps.' },
                                { name: 'Sissy Squat (Asistida)', sets: 3, reps: 'Al fallo', rest: '60s', rir: '1', tip: 'Ag√°rrate de una mesa. Lleva rodillas adelante y torso atr√°s.' },
                                { name: 'Plancha Abdominal', sets: 3, reps: '45s', rest: '60s', rir: '-', tip: 'Cuerpo recto como tabla.' }
                            ]
                        }
                    },
                    // D√çA 2: TORSO COMPLETO
                    1: {
                        gym: {
                            exercises: [
                                { name: 'Press Banca Plano', sets: 4, reps: '8-10', rest: '90s', rir: '2', tip: 'Retrae esc√°pulas. Arco natural en espalda baja.' },
                                { name: 'Remo con Barra (Pendlay)', sets: 4, reps: '8-10', rest: '90s', rir: '2', tip: 'Torso paralelo al suelo. Barra toca el suelo en cada rep.' },
                                { name: 'Press Militar con Mancuernas', sets: 3, reps: '10-12', rest: '75s', rir: '2', tip: 'Sentado. Rango completo de movimiento.' },
                                { name: 'Jal√≥n al Pecho (Agarre Neutro)', sets: 3, reps: '10-12', rest: '75s', rir: '2', tip: 'Lleva la barra a la parte alta del pecho.' },
                                { name: 'Elevaciones Laterales', sets: 3, reps: '15-20', rest: '60s', rir: '1-2', tip: 'Codos lideran el movimiento.' }
                            ]
                        },
                        casa: {
                            exercises: [
                                { name: 'Flexiones Diamante (o cerradas)', sets: 4, reps: 'Al fallo', rest: '90s', rir: '1', tip: 'Manos juntas. Enfoca en tr√≠ceps y pecho interior.' },
                                { name: 'Remo Unilateral con Mochila', sets: 4, reps: '12-15 c/u', rest: '75s', rir: '1-2', tip: 'Ap√≥yate en una silla. Espalda recta.' },
                                { name: 'Pike Push-ups', sets: 3, reps: '8-12', rest: '90s', rir: '2', tip: 'Cabeza baja formando un tri√°ngulo con manos.' },
                                { name: 'Dominadas (o Remo Invertido)', sets: 3, reps: 'Al fallo', rest: '90s', rir: '1', tip: 'Si no tienes barra, haz remo invertido bajo mesa.' },
                                { name: 'Vuelos Laterales con Botellas', sets: 3, reps: '20-25', rest: '45s', rir: '1', tip: 'Movimiento controlado, sin inercia.' }
                            ]
                        }
                    },
                    // D√çA 3: DESCANSO
                    2: {
                        gym: { cardio: "Caminata ligera 10.000 pasos. Recuperaci√≥n activa." },
                        casa: { cardio: "Caminata ligera 10.000 pasos. Recuperaci√≥n activa." }
                    },
                    // D√çA 4: PIERNA CADENA POSTERIOR
                    3: {
                        gym: {
                            exercises: [
                                { name: 'Peso Muerto Rumano (Barra)', sets: 3, reps: '8-10', rest: '120s', rir: '2', tip: 'Empuja cadera atr√°s hasta sentir tensi√≥n m√°xima en isquios.' },
                                { name: 'Hip Thrust', sets: 4, reps: '10-12', rest: '90s', rir: '2', tip: 'Pausa de 2 segundos arriba contrayendo gl√∫teo.' },
                                { name: 'Curl Femoral Tumbado', sets: 3, reps: '12-15', rest: '75s', rir: '1-2', tip: 'No levantes la cadera del banco al subir.' },
                                { name: 'Pantorrilla de Pie', sets: 4, reps: '15-20', rest: '60s', rir: '1-2', tip: 'Rango completo. Pausa abajo y arriba.' },
                                { name: 'Abducci√≥n de Cadera (M√°quina)', sets: 3, reps: '15-20', rest: '60s', rir: '1-2', tip: 'Torso inclinado hacia adelante.' }
                            ]
                        },
                        casa: {
                            exercises: [
                                { name: 'Peso Muerto a 1 Pierna (Mochila)', sets: 3, reps: '10-12 c/u', rest: '75s', rir: '2', tip: 'Pierna de apoyo ligeramente flexionada.' },
                                { name: 'Puente de Gl√∫teos (Pies elevados)', sets: 4, reps: '15-20', rest: '60s', rir: '1-2', tip: 'Pies sobre silla/sof√° para mayor rango.' },
                                { name: 'Curl N√≥rdico (Negativas)', sets: 3, reps: '5-8', rest: '90s', rir: '1', tip: 'Baja lo m√°s lento posible (5 seg). Sube con ayuda.' },
                                { name: 'Elevaci√≥n de Talones a 1 Pierna', sets: 4, reps: '15-20', rest: '45s', rir: '1', tip: 'Sostente de la pared para equilibrio.' },
                                { name: 'Clamshells (con banda)', sets: 3, reps: '20/lado', rest: '45s', rir: '1', tip: 'Activa gl√∫teo medio.' }
                            ]
                        }
                    },
                    // D√çA 5: TORSO HIPERTROFIA
                    4: {
                        gym: {
                            exercises: [
                                { name: 'Press Inclinado (Mancuernas)', sets: 3, reps: '10-12', rest: '90s', rir: '2', tip: 'Banco a 30 grados. Estira bien el pecho.' },
                                { name: 'Remo en Polea Baja (Gironde)', sets: 3, reps: '12-15', rest: '75s', rir: '2', tip: 'Estira dorsal al frente, contrae atr√°s.' },
                                { name: 'Fondos en Paralelas', sets: 3, reps: 'Al fallo', rest: '90s', rir: '1', tip: 'Incl√≠nate adelante para pecho, recto para tr√≠ceps.' },
                                { name: 'Face Pulls', sets: 3, reps: '15-20', rest: '60s', rir: '2', tip: 'Tira hacia la frente, rota hombros atr√°s.' },
                                { name: 'Curl de B√≠ceps Barra Z', sets: 3, reps: '12-15', rest: '60s', rir: '1', tip: 'Codos pegados al cuerpo.' }
                            ]
                        },
                        casa: {
                            exercises: [
                                { name: 'Flexiones Declinadas', sets: 3, reps: 'Al fallo', rest: '90s', rir: '1', tip: 'Pies sobre silla. Enfoca haz clavicular.' },
                                { name: 'Remo Unilateral (Mochila)', sets: 3, reps: '15-20', rest: '60s', rir: '1', tip: 'Bombeo controlado.' },
                                { name: 'Fondos en Silla (Tr√≠ceps)', sets: 3, reps: '15-20', rest: '60s', rir: '1', tip: 'Baja controlado.' },
                                { name: 'Vuelos Posteriores (Botellas)', sets: 3, reps: '20-25', rest: '45s', rir: '1', tip: 'Torso paralelo al suelo. P√°jaro.' },
                                { name: 'Curl Martillo (Mochila/Botellas)', sets: 3, reps: '15-20', rest: '60s', rir: '1', tip: 'Palmas enfrentadas.' }
                            ]
                        }
                    }
                }
            },
            // Repetimos estructura para semanas 2, 3 y 4 con progresiones
            2: {
                focus: "Semana 2: Aumento de Carga",
                dias: ['D√≠a 1: Pierna', 'D√≠a 2: Torso', 'D√≠a 3: Descanso', 'D√≠a 4: Pierna Post.', 'D√≠a 5: Torso'],
                workouts: { /* ... Copia de semana 1 con m√°s series/peso ... */ } 
            },
            3: {
                focus: "Semana 3: Pico de Volumen",
                dias: ['D√≠a 1: Pierna', 'D√≠a 2: Torso', 'D√≠a 3: Descanso', 'D√≠a 4: Pierna Post.', 'D√≠a 5: Torso'],
                workouts: { /* ... */ }
            },
            4: {
                focus: "Semana 4: Descarga",
                dias: ['D√≠a 1: Full Body', 'D√≠a 2: Descanso', 'D√≠a 3: Full Body', 'D√≠a 4: Descanso'],
                workouts: { /* ... Rutina ligera ... */ }
            }
        }
    };

    // CLONAR SEMANAS (Truco para no hacer el c√≥digo eterno, en producci√≥n detallar√≠as cada una)
    programData.semanas[2] = JSON.parse(JSON.stringify(programData.semanas[1]));
    programData.semanas[2].focus = "Semana 2: Sobrecarga";
    
    programData.semanas[3] = JSON.parse(JSON.stringify(programData.semanas[1]));
    programData.semanas[3].focus = "Semana 3: Intensidad M√°xima (RIR 1)";

    // Semana 4 ligera manual
    programData.semanas[4] = {
        focus: "Semana 4: Descarga Activa",
        dias: ['D√≠a 1: Full Body Ligero', 'D√≠a 2: Descanso', 'D√≠a 3: Full Body Ligero'],
        workouts: {
            0: { // D√≠a 1
                gym: { exercises: [{name: 'Sentadilla', sets: 2, reps: 10, tip: 'Suave'}, {name: 'Press Banca', sets: 2, reps: 10, tip: 'Suave'}, {name: 'Jal√≥n', sets: 2, reps: 10, tip: 'Suave'}] },
                casa: { exercises: [{name: 'Sentadilla aire', sets: 2, reps: 15, tip: 'Suave'}, {name: 'Flexiones', sets: 2, reps: 10, tip: 'Suave'}, {name: 'Remo Invertido', sets: 2, reps: 10, tip: 'Suave'}] }
            },
            2: { // D√≠a 3
                gym: { exercises: [{name: 'Peso Muerto Rumano', sets: 2, reps: 10, tip: 'Suave'}, {name: 'Press Militar', sets: 2, reps: 10, tip: 'Suave'}] },
                casa: { exercises: [{name: 'Puente Gl√∫teo', sets: 2, reps: 15, tip: 'Suave'}, {name: 'Pike Pushups', sets: 2, reps: 8, tip: 'Suave'}] }
            }
        }
    };


    // ==========================================
    // L√ìGICA DE INTERFAZ (IGUAL QUE NIVEL 1)
    // ==========================================
    let currentWeek = 1;
    let currentMode = 'gym';
    const storageKeyBase = `milonNivel${programData.nivel}`;

    const workoutTitle = document.getElementById('workout-title');
    const introTextContainer = document.getElementById('level-intro-text');
    const weekTabsContainer = document.getElementById('week-tabs');
    const dayTabsContainer = document.getElementById('day-tabs');
    const workoutsContainer = document.getElementById('workouts-container');
    const calendarContainer = document.querySelector('#calendario .flex');
    
    // Modales
    const openGuideBtn = document.getElementById('open-guide-btn');
    const closeGuideBtn = document.getElementById('close-guide-btn');
    const guideModal = document.getElementById('guide-modal');
    const openTheoryBtn = document.getElementById('open-theory-btn');
    const closeTheoryBtn = document.getElementById('close-theory-btn');
    const theoryModal = document.getElementById('theory-modal');
    const guideModalTitle = document.getElementById('guide-modal-title');
    
    const modeBtnGym = document.getElementById('mode-btn-gym');
    const modeBtnCasa = document.getElementById('mode-btn-casa');
    let currentDayIndex = 0;

    function setMainMode(mode, save = true) {
        currentMode = mode;
        if (save) localStorage.setItem(`${storageKeyBase}Mode`, mode);
        updateModeButtons();
        showWorkout(currentDayIndex);
    }

    function updateModeButtons() {
        if (currentMode === 'gym') {
            modeBtnGym.classList.add('active');
            modeBtnCasa.classList.remove('active');
        } else {
            modeBtnCasa.classList.add('active');
            modeBtnGym.classList.remove('active');
        }
    }

    function loadMainMode() {
        const savedMode = localStorage.getItem(`${storageKeyBase}Mode`);
        if (savedMode) currentMode = savedMode;
        updateModeButtons();
    }

    function showWorkoutView() {
        workoutTitle.innerHTML = programData.titulo;
        introTextContainer.textContent = programData.intro;
        generateWeekTabs(Object.keys(programData.semanas));
        const savedWeek = localStorage.getItem(`${storageKeyBase}Week`);
        showWeek(savedWeek ? parseInt(savedWeek) : 1);
    }

    function generateWeekTabs(weeks) {
        weekTabsContainer.innerHTML = '';
        weeks.forEach(weekNumber => {
            const weekData = programData.semanas[weekNumber];
            const tab = document.createElement('button');
            // CORRECCI√ìN FINAL: Eliminada la clase font-sans del span y whitespace-nowrap
            tab.className = `week-tab py-2 px-4 font-bebas text-lg rounded-t-lg week-tab-inactive`;
            tab.innerHTML = `Semana ${weekNumber}<br><span class="text-xs font-normal">${weekData.focus}</span>`;
            tab.onclick = () => showWeek(weekNumber);
            weekTabsContainer.appendChild(tab);
        });
    }

    function showWeek(weekNumber) {
        currentWeek = weekNumber;
        localStorage.setItem(`${storageKeyBase}Week`, weekNumber);
        
        document.querySelectorAll('.week-tab').forEach((tab, index) => {
            tab.classList.toggle('week-tab-active', (index + 1) == weekNumber);
            tab.classList.toggle('week-tab-inactive', (index + 1) != weekNumber);
        });
        
        const weekData = programData.semanas[weekNumber];
        generateDayTabs(weekData.dias);
        generateCalendar(weekData.dias);
        
        const savedDay = localStorage.getItem(`${storageKeyBase}Day_w${currentWeek}`);
        showWorkout(savedDay ? parseInt(savedDay) : 0);
    }

    function generateDayTabs(days) {
        dayTabsContainer.innerHTML = '';
        days.forEach((day, index) => {
            const tab = document.createElement('button');
            tab.className = `day-tab py-2 px-4 font-bebas text-md rounded-lg m-1 day-tab-inactive`;
            tab.textContent = day;
            tab.onclick = () => showWorkout(index);
            dayTabsContainer.appendChild(tab);
        });
    }

    function showWorkout(dayIndex) {
        currentDayIndex = dayIndex;
        localStorage.setItem(`${storageKeyBase}Day_w${currentWeek}`, dayIndex);

        document.querySelectorAll('.day-tab').forEach((tab, index) => {
            tab.classList.toggle('day-tab-active', index === dayIndex);
            tab.classList.toggle('day-tab-inactive', index !== dayIndex);
        });

        const weekWorkouts = programData.semanas[currentWeek].workouts;
        const dayData = weekWorkouts[dayIndex] ? weekWorkouts[dayIndex][currentMode] : null;

        workoutsContainer.innerHTML = '';

        if (!dayData || (!dayData.exercises && !dayData.cardio)) {
            workoutsContainer.innerHTML = `<div class="bg-white p-8 rounded-lg shadow text-center"><p class="text-xl text-gray-500 font-bebas">D√≠a de Descanso o Cardio Ligero</p></div>`;
            return;
        }

        if (dayData.exercises) {
            dayData.exercises.forEach((ex, exIndex) => {
                const uniqueId = `prog-${programData.nivel}-w${currentWeek}-d${dayIndex}-m${currentMode}-${exIndex}`;
                const setsCheckboxes = Array.from({ length: ex.sets || 0 }, (_, i) => `
                    <div class="flex items-center">
                        <input type="checkbox" id="set-${uniqueId}-${i}" class="set-checkbox h-4 w-4 rounded bg-gray-100 border-gray-300 text-amber-500 focus:ring-amber-600 transition cursor-pointer">
                        <label for="set-${uniqueId}-${i}" class="ml-2 text-sm text-gray-600">Serie ${i + 1}</label>
                    </div>`).join('');
                
                const exerciseCard = document.createElement('div');
                exerciseCard.className = "bg-white border border-gray-200 p-5 rounded-lg shadow-sm";
                exerciseCard.innerHTML = `
                    <div class="flex justify-between items-start flex-wrap gap-4">
                        <div class="flex-1">
                            <h4 class="text-2xl text-gray-900">${ex.name}</h4>
                            <div class="flex flex-wrap items-center gap-3 mt-1">
                                <p class="text-amber-600 font-semibold text-sm">${ex.sets || 'N/A'} series x ${ex.reps || 'N/A'} reps</p>
                                <p class="text-gray-600 text-xs">
                                    ${ex.rest ? `Desc: ${ex.rest}` : ''}
                                     ${ex.rir ? `| RIR: ${ex.rir}` : ''}
                                </p>
                            </div>
                            <div class="mt-2 flex items-center gap-2">
                                <label for="weight-${uniqueId}" class="text-sm font-semibold text-gray-500">Peso:</label>
                                <input type="text" id="weight-${uniqueId}" class="weight-input w-24 rounded-md border-gray-300 shadow-sm text-sm focus:ring-amber-500 focus:border-amber-500" placeholder="ej: 10kg">
                            </div>
                        </div>
                        <div class="flex flex-col space-y-1">${setsCheckboxes}</div>
                    </div>
                    ${ex.tip ? `<p class="text-sm mt-3 pt-3 border-t border-gray-200 text-gray-600"><strong>T√©cnica Clave:</strong> ${ex.tip}</p>` : ''}`;
                workoutsContainer.appendChild(exerciseCard);
            });
        }

        if (dayData.cardio) {
            workoutsContainer.innerHTML += `
                <div class="bg-white border-2 border-dashed border-amber-400 p-5 rounded-lg mt-6 flex items-center gap-4">
                    <div class="bg-amber-100 p-3 rounded-full text-amber-600">üèÉ‚Äç‚ôÇÔ∏è</div>
                    <div>
                        <h4 class="text-xl text-gray-900 font-bebas">Cardio & Recuperaci√≥n</h4>
                        <p class="text-gray-700">${dayData.cardio}</p>
                    </div>
                </div>`;
        }
        loadAndSaveProgress();
    }

    function generateCalendar(days) {
        calendarContainer.innerHTML = '';
        const weekEl = document.createElement('div');
        weekEl.className = 'bg-white border border-gray-200 p-4 rounded-lg w-full max-w-4xl shadow-sm';
        weekEl.innerHTML = `<h3 class="text-lg text-gray-900 text-center mb-3 font-bold uppercase tracking-wider">Tu Progreso - Semana ${currentWeek}</h3>`;
        
        const weekGrid = document.createElement('div');
        weekGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 text-center';
        
        days.forEach((day, dayIndex) => {
            const dayEl = document.createElement('div');
            let dayName = day.split(':')[0].replace('D√≠a ', 'D');
            const dayId = `cal-${storageKeyBase}-w${currentWeek}-d${dayIndex}`;
            dayEl.id = dayId;
            dayEl.className = 'calendar-day bg-gray-100 text-gray-500 p-3 rounded-md cursor-pointer border-2 border-transparent hover:border-amber-400 transition-all font-bold text-sm shadow-sm';
            dayEl.textContent = day;
            
            if (localStorage.getItem(dayId) === 'true') {
                dayEl.classList.add('day-checked');
            }
            
            dayEl.addEventListener('click', () => {
                dayEl.classList.toggle('day-checked');
                localStorage.setItem(dayId, dayEl.classList.contains('day-checked'));
            });
            weekGrid.appendChild(dayEl);
        });
        
        weekEl.appendChild(weekGrid);
        calendarContainer.appendChild(weekEl);
    }

    function loadAndSaveProgress() {
        document.querySelectorAll('.set-checkbox').forEach(checkbox => {
            if (localStorage.getItem(checkbox.id) === 'true') checkbox.checked = true;
            checkbox.addEventListener('change', () => localStorage.setItem(checkbox.id, checkbox.checked));
        });
        document.querySelectorAll('.weight-input').forEach(input => {
            input.value = localStorage.getItem(input.id) || '';
            input.addEventListener('input', () => localStorage.setItem(input.id, input.value));
        });
    }

    // Modal Logic
    function openModal(modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        setTimeout(() => modal.querySelector('.bg-black').classList.remove('opacity-0'), 10);
        setTimeout(() => modal.querySelector('.transform').classList.remove('scale-95'), 10);
    }
    function closeModal(modal) {
        modal.querySelector('.transform').classList.add('scale-95');
        modal.querySelector('.bg-black').classList.add('opacity-0');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadMainMode();
        showWorkoutView();
        
        modeBtnGym.addEventListener('click', () => setMainMode('gym'));
        modeBtnCasa.addEventListener('click', () => setMainMode('casa'));
        
        openGuideBtn.addEventListener('click', () => {
            guideModalTitle.textContent = 'Gu√≠a Esencial del Nivel 2';
            openModal(guideModal);
        });
        closeGuideBtn.addEventListener('click', () => closeModal(guideModal));
        document.getElementById('guide-modal-overlay').addEventListener('click', () => closeModal(guideModal));
        
        openTheoryBtn.addEventListener('click', () => openModal(theoryModal));
        closeTheoryBtn.addEventListener('click', () => closeModal(theoryModal));
        document.getElementById('theory-modal-overlay').addEventListener('click', () => closeModal(theoryModal));
    });
</script>
</body>
</html>